<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 3.2//RU">
<HTML><HEAD>
<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=Windows-1251">
<TITLE>Лабораторная работа 3.2</TITLE>


</HEAD> 

<BODY BGCOLOR="#FFEFCF" 
 TEXT="black" LINK="blue" ALINK="red" VLINK="green">
<h1> cookie </h1>
<div id="welcome">
Приветствую посититель! <br>
Зарегистрируйся на нашем сайте:
<FORM  METHOD="POST">
<P> Введите имя: 
<INPUT id="input" TYPE="TEXT"> <br> <br>
<input id="login" type="button" value="Зарегистрироваться">
</FORM>
</div>

<div id="signin">
Привет, 
<script>
alert(getCookie("name");
//document.write(getCookie("name"));
</script>
! <br> Количество посещений этой страницы:
<script>
//document.write(cookies.visits);
</script>
<br>Вы были на этой странице:
<script>
//document.write(cookies.LastVisit);
</script>
назад.<br> <br> <input id="restart" type="button" value="Обнулить посещения">
<div>

<script>

if ("" == document.cookie){
//	welcome.style.display = "block";
	}
    else {
//	signin.style.display = "block";
        let cookies = parseCookie();
        // Увеличение числа посещений на 1.
        cookies.visits++;
        // Обновление cookie.
        setCookie(isNaN(cookies.visits)?1:cookies.visits, );
    }

function setCookie(visits, name) {
//       Счетчик числа посещений с указанием даты последнего посещения и определением срока хранения в 1 год. 
    let expireDate = new Date();
    let today = new Date();
	document.cookie = "name=" + name + ";";
    // Установка даты истечения срока хранения.
    expireDate.setDate(365 + expireDate.getDate());
    // Сохранение числа посещений.
    document.cookie = "visits=" + visits +
                      "; expires=" + expireDate.toGMTString() + ";";
    // Сохранение настоящей даты как времени последнего посещения.
    document.cookie = "LastVisit=" + escape(today.toGMTString()) +
                       "; expires=" + expireDate.toGMTString() + ";";
    }

function parseCookie(){   // Разделение cookie
	let cookieList = document.cookie.split("; ");
    // Массив для каждого cookie в cookieList
    let cookieArray = new Array();
    for (let i = 0; i < cookieList.length; i++) {
        // Разделение пар имя-значение.
        let name = cookieList[i].split("=");
        // Декодирование и добавление в cookie-массив.
        cookieArray[unescape(name[0])] = unescape(name[1]);
    }
    return cookieArray;
}
  
function getCookie(Name) {   
	let search = Name + "=";
		//Создается строка для поиска в document.cookie
	if (document.cookie.length > 0) {
		offset = document.cookie.indexOf(search);
			//Поиск cookie по ее имени
		if (offset != -1) {
			offset += search.length;
			end = document.cookie.indexOf(";", offset);
				//Определили положение нужной cookie, и по индексам вырежем ее
			if (end == -1)
				end = document.cookie.length;
			return unescape(document.cookie.substring(offset, end));
				//Вернули подстроку, содержащюю нужное значение cookie
		}
	}
};
login.onclick = function(){
	setCookie(1, input.value);
//	welcome.style.display = "none";
//	signin.style.display = "block";
};

</script>

</BODY>
</HTML>
